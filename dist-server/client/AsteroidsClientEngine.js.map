{"version":3,"sources":["../../src/client/AsteroidsClientEngine.js"],"names":["betaTiltThreshold","gammaTiltThreshold","steerThreshold","AsteroidsClientEngine","gameEngine","options","AsteroidsRenderer","isTouchDevice","document","querySelector","classList","remove","actions","Set","fireButton","style","opacity","boostButton","window","addEventListener","handleOrientation","bind","handleButton","on","preStep","controls","KeyboardControls","bindKey","repeat","action","ev","add","preventDefault","event","isPortrait","innerHeight","innerWidth","beta","gamma","flip","steerValue","Math","max","min","forEach","sendInput","movement","ClientEngine","navigator","maxTouchPoints"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\r\nimport AsteroidsRenderer from '../client/AsteroidsRenderer';\r\n\r\nconst betaTiltThreshold = 40;\r\nconst gammaTiltThreshold = 40;\r\nconst steerThreshold = 0.4;\r\n\r\nexport default class AsteroidsClientEngine extends ClientEngine {\r\n\r\n    constructor(gameEngine, options) {\r\n        super(gameEngine, options, AsteroidsRenderer);\r\n\r\n        //  Game input\r\n        if (isTouchDevice()) {\r\n            document.querySelector('#instructionsMobile').classList.remove('hidden');\r\n\r\n            this.actions = new Set();\r\n\r\n            this.fireButton = document.querySelector('.fireButton');\r\n            this.fireButton.style.opacity = 1;\r\n            this.boostButton = document.querySelector('.boostButton');\r\n            this.boostButton.style.opacity = 1;\r\n            window.addEventListener('deviceorientation', this.handleOrientation.bind(this));\r\n            this.fireButton.addEventListener('touchstart', this.handleButton.bind(this, 'space'), false);\r\n            this.boostButton.addEventListener('touchstart', this.handleButton.bind(this, 'up'), false);\r\n            this.gameEngine.on('client__preStep', this.preStep.bind(this));\r\n        } else {\r\n            document.querySelector('#instructions').classList.remove('hidden');\r\n            this.controls = new KeyboardControls(this);\r\n            this.controls.bindKey('up', 'up', { repeat: true } );\r\n            this.controls.bindKey('down', 'down', { repeat: true } );\r\n            this.controls.bindKey('left', 'left', { repeat: true } );\r\n            this.controls.bindKey('right', 'right', { repeat: true } );\r\n            this.controls.bindKey('space', 'space');\r\n        }\r\n    }\r\n\r\n    handleButton(action, ev) {\r\n        this.actions.add(action);\r\n        ev.preventDefault();\r\n    }\r\n\r\n    handleOrientation(event) {\r\n        let isPortrait = window.innerHeight > window.innerWidth;\r\n        let beta = event.beta;  // In degree in the range [-180,180]\r\n        let gamma = event.gamma; // In degree in the range [-90,90]\r\n        let flip = gamma > 0;\r\n        let steerValue = Math.max(-1, Math.min(1, beta / betaTiltThreshold)) * (flip?-1:1);\r\n        if (isPortrait) {\r\n            flip = beta < 0;\r\n            steerValue = Math.max(-1, Math.min(1, gamma / gammaTiltThreshold)) * (flip?-1:1);\r\n        }\r\n\r\n        this.actions.delete('left');\r\n        this.actions.delete('right');\r\n        if (steerValue < -steerThreshold) this.actions.add('left');\r\n        else if (steerValue > steerThreshold) this.actions.add('right');\r\n    }\r\n\r\n    // our pre-step is to process inputs that are \"currently pressed\" during the game step\r\n    preStep() {\r\n        this.actions.forEach((action) => this.sendInput(action, { movement: true }));\r\n        this.actions = new Set();\r\n    }\r\n\r\n}\r\n\r\nfunction isTouchDevice() {\r\n    return 'ontouchstart' in window || navigator.maxTouchPoints;\r\n}\r\n"],"file":"AsteroidsClientEngine.js"}