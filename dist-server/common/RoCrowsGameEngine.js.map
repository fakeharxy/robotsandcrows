{"version":3,"sources":["../../src/common/RoCrowsGameEngine.js"],"names":["RoCrowsGameEngine","options","physicsEngine","P2PhysicsEngine","gameEngine","world","defaultContactMaterial","friction","on","warpAll","bind","steerCrows","Object","assign","spaceWidth","spaceHeight","aviaryRadius","crowRadius","robotSize","crowSpeed","robotSpeed","grabDuration","ROBOT","Math","pow","CROW","AVIARY","queryObjects","instanceType","Crow","forEach","crow","robot","queryObject","playerId","Robot","vecBearing","TwoVector","copy","position","subtract","scaleFactor","length","multiplyScalar","velocity","refreshToPhysics","forEachObject","id","obj","p","x","y","serializer","registerClass","Aviary","inputData","playerAviary","emit","input","random","rand","vx","vy","va","a","mass","angularVelocity","addObjectToWorld","playerAviaryBody","physicsObj","s","key","message","messageAngle","PI","angle","grabberActive","timer","add","cancelGrab","removeObjectFromWorld","console","log","robotId","robot1","robot2","asteroid","bullet","asteroidBody","level","r","asteroidRadius","numAsteroidLevels","angleDisturb","i","subAsteroid","Asteroid","cos","sin","trace","info","toString","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, P2PhysicsEngine, TwoVector } from 'lance-gg';\r\nimport Aviary from './Aviary';\r\nimport Crow from './Crow';\r\nimport Robot from './Robot';\r\n\r\nexport default class RoCrowsGameEngine extends GameEngine {\r\n\r\n    constructor(options) {\r\n        super(options);\r\n\r\n        // create physics with no friction; wrap positions after each step\r\n        this.physicsEngine = new P2PhysicsEngine({ gameEngine: this });\r\n        this.physicsEngine.world.defaultContactMaterial.friction = 0;\r\n        this.on('postStep', this.warpAll.bind(this));\r\n\r\n        //steer crows towards robots each step\r\n        this.on('postStep', this.steerCrows.bind(this));\r\n\r\n\r\n        // game variables\r\n        Object.assign(this, {\r\n            /*\r\n            lives: 3, shipSize: 0.3, shipTurnSpeed: 0.05, shipSpeed: 2, bulletRadius: 0.03, bulletLifeTime: 60,\r\n            asteroidRadius: 0.9, numAsteroidLevels: 4, numAsteroidVerts: 6, maxAsteroidSpeed: 2,\r\n            */\r\n            spaceWidth: 16, spaceHeight: 9, \r\n\r\n            aviaryRadius: 0.1,\r\n            crowRadius: 0.06,\r\n            robotSize: 0.2,\r\n\r\n            crowSpeed: 1.5,\r\n            robotSpeed: 0.5,\r\n\r\n            grabDuration: 120,\r\n\r\n            // collision groups\r\n            ROBOT: Math.pow(2, 1), CROW: Math.pow(2, 2), AVIARY: Math.pow(2, 3),\r\n        });\r\n    }\r\n\r\n    // steer the crows towards their players' robots\r\n    steerCrows() {\r\n        this.world.queryObjects({ instanceType: Crow }).forEach(crow => {\r\n            // find corresponding robot\r\n            let robot = this.world.queryObject({ playerId: crow.playerId, instanceType: Robot });\r\n            if (robot) {\r\n              // calculate crow vector based on target robot\r\n              let vecBearing = new TwoVector();\r\n              vecBearing.copy(robot.position);\r\n              vecBearing.subtract(crow.position);\r\n              let scaleFactor = this.crowSpeed / vecBearing.length();\r\n              vecBearing.multiplyScalar(scaleFactor);\r\n              crow.velocity = vecBearing;\r\n              crow.refreshToPhysics();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    // If the body is out of space bounds, warp it to the other side\r\n    warpAll() {\r\n        this.world.forEachObject((id, obj) => {\r\n            let p = obj.position;\r\n            if(p.x > this.spaceWidth/2) p.x -= this.spaceWidth;\r\n            if(p.y > this.spaceHeight/2) p.y -= this.spaceHeight;\r\n            if(p.x < -this.spaceWidth /2) p.x += this.spaceWidth;\r\n            if(p.y < -this.spaceHeight/2) p.y += this.spaceHeight;\r\n            obj.refreshToPhysics();\r\n        });\r\n    }\r\n\r\n    registerClasses(serializer) {\r\n        serializer.registerClass(Robot);\r\n        serializer.registerClass(Aviary);\r\n        serializer.registerClass(Crow);\r\n    }\r\n\r\n    processInput(inputData, playerId) {\r\n\r\n        super.processInput(inputData, playerId);\r\n\r\n        // handle keyboard presses\r\n        // if immediate responses are required, they can be handled here but use extreme caution (or learn about shadow objects) if new objects will have to be created\r\n        let playerAviary = this.world.queryObject({ playerId: playerId, instanceType: Aviary });\r\n        if (playerAviary) {\r\n            this.emit('releaseCrow', playerAviary, inputData.input);\r\n        }\r\n    }\r\n\r\n    // returns a random number between -0.5 and 0.5\r\n    rand() {\r\n        return Math.random() - 0.5;\r\n    }\r\n\r\n    // create aviary\r\n    addAviary(playerId) {\r\n        let x = this.rand() * this.spaceWidth;\r\n        let y = this.rand() * this.spaceHeight;\r\n        let vx = 0;\r\n        let vy = 0;\r\n        let va = 0;\r\n        \r\n        let a = new Aviary(this, {}, {\r\n            playerId: playerId,\r\n            mass: 100, angularVelocity: va,\r\n            position: new TwoVector(x, y),\r\n            velocity: new TwoVector(vx, vy)\r\n        });\r\n        this.addObjectToWorld(a);\r\n    }\r\n    \r\n    // create robot\r\n    addRobot(playerId) {\r\n        //find player's aviary and place robot nearby\r\n        let playerAviaryBody = this.world.queryObject({ playerId: playerId, instanceType: Aviary }).physicsObj;\r\n        let x = playerAviaryBody.position[0];\r\n        x += this.aviaryRadius * 3 * (x > 0 ? -1 : 1);\r\n        let y = playerAviaryBody.position[1];\r\n        y += this.aviaryRadius * 3 * (y > 0 ? -1 : 1);\r\n        let vx = 0;\r\n        let vy = 0;\r\n\r\n        let s = new Robot(this, {}, {\r\n            playerId: playerId,\r\n            mass: 10, angularVelocity: 0,\r\n            position: new TwoVector(x, y), \r\n            velocity: new TwoVector(vx, vy)\r\n        });\r\n        //s.lives = this.lives;\r\n        this.addObjectToWorld(s);\r\n    }\r\n    \r\n    addCrow(playerAviary, key) {\r\n        //release a crow from the aviary\r\n        let vx = 0;\r\n        let vy = 0;\r\n\r\n        let crow = new Crow(this, {}, {\r\n            playerId: playerAviary.playerId,\r\n            mass: 0.0001, angularVelocity: 0,\r\n            position: playerAviary.position, //is copied anyway\r\n            velocity: new TwoVector(vx, vy)\r\n        });\r\n        crow.message = key;\r\n        if (crow.message === 'up') {\r\n            crow.messageAngle = 0;\r\n        } else if (crow.message === 'right') {\r\n            crow.messageAngle = Math.PI / 2;\r\n        } else if (crow.message === 'left') {\r\n            crow.messageAngle = -Math.PI / 2\r\n        } else if (crow.message === 'down') {\r\n            crow.messageAngle = Math.PI;\r\n        }\r\n        this.addObjectToWorld(crow);\r\n    }\r\n\r\n    // crow has arrived at a robot; can possibly deliver message\r\n    crowArrived(crow, robot) {\r\n        if (crow.playerId === robot.playerId) {\r\n            //console.log(\"crow delivered message \" + crow.message);\r\n            if (crow.message === 'up') {\r\n                robot.velocity = new TwoVector(0, this.robotSpeed);\r\n                robot.angle = crow.messageAngle;\r\n            } else if (crow.message === 'right') {\r\n                robot.velocity = new TwoVector(this.robotSpeed, 0);\r\n                robot.angle = crow.messageAngle;\r\n            } else if (crow.message === 'left') {\r\n                robot.velocity = new TwoVector(-this.robotSpeed, 0);\r\n                robot.angle = crow.messageAngle;\r\n            } else if (crow.message === 'down') {\r\n                robot.velocity = new TwoVector(0, -this.robotSpeed);\r\n                robot.angle = crow.messageAngle;\r\n\r\n            } else if (crow.message === 'space') {\r\n                if (!robot.grabberActive) {\r\n                    robot.grabberActive = true;\r\n                    this.timer.add(this.grabDuration, this.cancelGrab, this, [robot.id]);\r\n                }  \r\n            }\r\n\r\n            robot.angularVelocity = 0;\r\n            robot.refreshToPhysics();\r\n            this.removeObjectFromWorld(crow.id);\r\n        } else {\r\n            console.log(\"crow flew over competitor robot\");\r\n        }\r\n    }\r\n\r\n    cancelGrab(robotId) {\r\n        //this.emit('cancelGrab', robotId); // is it necessary to emit this??\r\n        let robot = this.world.queryObject({ id: robotId });\r\n        if (robot && robot instanceof Robot) {\r\n            robot.grabberActive = false;\r\n        }\r\n    }\r\n\r\n    // two robots have hit each other TODO dead stop? bounce? damage?\r\n    robotCrash(robot1, robot2) {\r\n        console.log(\"robot crash!\");\r\n    }\r\n\r\n    // asteroid explosion\r\n    explode(asteroid, bullet) {\r\n\r\n        // Remove asteroid and bullet\r\n        let asteroidBody = asteroid.physicsObj;\r\n        let level = asteroid.level;\r\n        let x = asteroidBody.position[0];\r\n        let y = asteroidBody.position[1];\r\n        let r = this.asteroidRadius * (this.numAsteroidLevels - level) / this.numAsteroidLevels;\r\n        this.removeObjectFromWorld(asteroid);\r\n        this.removeObjectFromWorld(bullet);\r\n\r\n        // Add new sub-asteroids\r\n        if (level < 3) {\r\n            let angleDisturb = Math.PI/2 * Math.random();\r\n            for (let i=0; i<4; i++) {\r\n                let angle = Math.PI/2 * i + angleDisturb;\r\n                let subAsteroid = new Asteroid(this, {}, {\r\n                    mass: 10,\r\n                    position: new TwoVector(x + r * Math.cos(angle), y + r * Math.sin(angle)),\r\n                    velocity: new TwoVector(this.rand(), this.rand())\r\n                });\r\n                subAsteroid.level = level + 1;\r\n                this.trace.info(() => `creating sub-asteroid with radius ${r}: ${subAsteroid.toString()}`);\r\n                this.addObjectToWorld(subAsteroid);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"file":"RoCrowsGameEngine.js"}